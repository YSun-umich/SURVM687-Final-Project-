---
title: '687'
author: "Yuchen Ding"
date: "2025-10-21"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Load packages
```{r, echo=TRUE}
library(lme4)
library(nlme)
library(lmerTest)
library(tidyverse)
```


## Data Import
```{r}
data <- read_csv("df_long_filtered.10.04.csv")
```

```{r}
data <- data %>%
  mutate(educ_high = ifelse(SCHLYRS >= 12, "High", "Low")) %>%
  mutate(educ_high = factor(educ_high, levels = c("Low", "High")))
```



## Initial Model
```{r}
mod0 <- lmer(SLFMEM ~ 1 + (1 | HHIDPN), data = data, REML = T)
summary(mod0)

rand(mod0)
AIC(mod0)
BIC(mod0)
```
Initial Model: Interpretation

1. The estimated mean (intercept) is      $\hat{\beta}_0$= 5.648e-04

2. The estimated variance of the random interviewer effects is     $\hat{\sigma}_0^2$ = 8.295e-08

3. The estimated residual variance is     $\hat{\sigma}^2$ = 5.645e-04

4. The estimated intra-interviewer correlation (or ICC) is       
	$\hat{\rho}$ = 8.295e-08 / (8.295e-08 + 5.645e-04) = 0.00015, which indicates that less than 0.02% of the total variance is attributable to between-wave differences. Almost all variation is within waves (i.e., between individuals at the same wave).
	
5. The likelihood ratio test for the random intercept variance component indicates that the between-wave variance is statistically significant (LRT = 40.83, p < 0.001).


```{r, echo=TRUE}
# Random intercepts (EBLUPs)
qqnorm(ranef(mod0)$wave[,1])
qqline(ranef(mod0)$wave[,1])
```

```{r, echo=TRUE}
# Residuals
qqnorm(resid(mod0))
qqline(resid(mod0))
plot(resid(mod0), fitted(mod0))
```



## Adding the key IV
```{r}
mod1 <- lmer(SLFMEM ~ SCHLYRS + (1 | wave), data = data, REML = T)
summary(mod1)

AIC(mod1)
BIC(mod1)
```
This coefficient is not statistically significant, indicating no detectable linear relationship between education degree level and self-rated memory in this specification.

```{r}
mod10 <- lmer(SLFMEM ~ educ_high + (1 | wave), data = data, REML = T)
summary(mod10)

AIC(mod10)
BIC(mod10)
```



## Adding the control variables
```{r}
mod2 <- lmer(SLFMEM ~ SCHLYRS + factor(GENDER)+ factor(RACE) + IWLANG + factor(IWMODE + (1 | wave)), data = data, REML = T)
summary(mod2)

AIC(mod2)
BIC(mod2)
```


## Random Effects Model
```{r}

mod3 <- lmer(SLFMEM ~ SCHLYRS + factor(GENDER) + factor(RACE) + IWLANG + IWMODE + (SCHLYRS | wave), data = data, REML = T)
summary(mod3)

AIC(mod3)
BIC(mod3)
```
## Baselines
```{r}
mod4 <- lmer(SLFMEM ~ SCHLYRS * wave + (1 | HHIDPN), data = data, REML = T)
summary(mod4)

AIC(mod4)
BIC(mod4)
```

```{r}
mod5 <- lmer(SLFMEM ~ SCHLYRS * wave + (1 + wave | HHIDPN), data = data, REML = T)
summary(mod5)

AIC(mod5)
BIC(mod5)
```


